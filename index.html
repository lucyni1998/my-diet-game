<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡è¡¡é£²é£ŸæŒ‘æˆ° - å°ç²¾éˆé€²åŒ–ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        
        :root {
            --bg-dark: #0f172a;
            --khaki-nut: #C3B091; 
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-dark);
            color: white;
            height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* é¤ç›¤é…ç½® */
        .plate-container {
            position: relative;
            background: rgba(255,255,255,0.05);
            padding: 50px 70px;
            border-radius: 60px;
            border: 2px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
        }

        .plate-main {
            position: relative;
            width: 480px;
            height: 340px;
            background-color: #1e293b;
            border-radius: 40px;
            border: 12px solid #334155;
            display: flex;
            gap: 10px;
            padding: 10px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .drop-zone {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .drop-zone.active {
            filter: brightness(1.3);
            transform: scale(1.02);
            box-shadow: inset 0 0 20px rgba(255,255,255,0.3);
        }

        .col-left { width: 25%; background-color: #ea580c; border-radius: 25px 8px 8px 25px; }
        .col-mid { width: 35%; background-color: #16a34a; border-radius: 8px; }
        .col-right { width: 40%; display: flex; flex-direction: column; gap: 10px; }
        
        #zone-milk {
            position: absolute; top: -30px; left: -30px; width: 110px; height: 110px;
            border-radius: 50%; background: #3b82f6; border: 6px solid #fff; z-index: 50;
        }
        #zone-oil {
            position: absolute; top: 50%; left: 60%; transform: translate(-50%, -50%);
            width: 80px; height: 80px; border-radius: 50%; 
            background: var(--khaki-nut);
            border: 4px solid #fff; z-index: 45;
        }
        #zone-protein { height: 48%; background-color: #db2777; border-radius: 8px 25px 8px 8px; }
        #zone-grain { height: 48%; background-color: #ca8a04; border-radius: 8px 8px 25px 8px; }

        .zone-label { font-weight: 900; pointer-events: none; text-align: center; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }

        /* é£Ÿç‰©å¡ç‰‡ */
        .food-pool {
            background: rgba(30, 41, 59, 0.8); border-radius: 24px; padding: 12px;
            border: 1px solid rgba(255,255,255,0.1); flex: 1; overflow-y: auto;
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
        }

        .food-card {
            cursor: grab; background: #334155; border-radius: 12px; padding: 10px 4px;
            text-align: center; transition: all 0.2s; border: 2px solid transparent;
        }
        .food-card:hover { background: #475569; border-color: #0ea5e9; }

        .placed-item {
            position: absolute; font-size: 3.5rem; z-index: 60; pointer-events: none;
            transform: translate(-50%, -50%); animation: itemPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes itemPop { from { transform: translate(-50%, -50%) scale(0); opacity: 0; } to { transform: translate(-50%, -50%) scale(1); opacity: 1; } }

        .sprite-bubble {
            background: white; color: #0f172a; padding: 12px; border-radius: 16px;
            font-weight: 800; font-size: 0.85rem; position: relative; margin-bottom: 10px;
            border: 3px solid #0ea5e9; text-align: center; width: 100%;
            animation: bubbleFloat 2s ease-in-out infinite;
        }
        @keyframes bubbleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .sprite-bubble::after {
            content: ''; position: absolute; bottom: -12px; left: 50%; transform: translateX(-50%);
            border-width: 12px 10px 0; border-style: solid; border-color: #0ea5e9 transparent transparent;
        }

        /* éš±è—æ»¾å‹•æ¢ä½†ä¿ç•™åŠŸèƒ½ */
        ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
</head>
<body>

    <header class="w-full px-8 py-4 bg-slate-900 border-b border-white/5 flex justify-between items-center">
        <div class="flex items-center gap-4">
            <span class="text-4xl">ğŸ¥—</span>
            <div>
                <h1 class="text-xl font-black text-white tracking-widest">å‡è¡¡é£²é£ŸæŒ‘æˆ°</h1>
                <p class="text-[10px] text-sky-400 font-bold uppercase tracking-tighter">Educational Dynamic System v8</p>
            </div>
        </div>
        <div class="flex gap-8">
            <div class="flex flex-col items-center">
                <span class="text-[10px] text-slate-400 font-bold">å‰©é¤˜æ™‚é–“</span>
                <span id="timer-text" class="text-2xl font-black text-white">30s</span>
            </div>
            <div class="flex flex-col items-center">
                <span class="text-[10px] text-slate-400 font-bold">æ”¶é›†é€²åº¦</span>
                <div class="bg-sky-500/10 border border-sky-500/50 px-4 py-1 rounded-xl">
                    <span id="score-text" class="text-2xl font-black text-sky-400">0 / 6</span>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-1 flex flex-row items-center justify-center gap-12 p-8 overflow-hidden">
        <!-- é¤ç›¤ -->
        <div class="plate-container">
            <div class="plate-main" id="main-plate">
                <div id="zone-milk" class="drop-zone" data-category="milk"><span class="zone-label text-sm">ä¹³å“</span></div>
                <div id="zone-oil" class="drop-zone" data-category="oil"><span class="zone-label text-[10px] leading-tight">å …æœ<br>ç¨®å­</span></div>
                <div id="zone-fruit" class="drop-zone col-left" data-category="fruit"><span class="zone-label">æ°´æœ</span></div>
                <div id="zone-veg" class="drop-zone col-mid" data-category="vegetable"><span class="zone-label">è”¬èœ</span></div>
                <div class="col-right">
                    <div id="zone-protein" class="drop-zone" data-category="protein"><span class="zone-label">è±†é­šè›‹è‚‰</span></div>
                    <div id="zone-grain" class="drop-zone" data-category="grain"><span class="zone-label">å…¨ç©€é›œç³§</span></div>
                </div>
                <div id="placed-items-container" class="absolute inset-0 pointer-events-none"></div>
            </div>
        </div>

        <!-- å´é‚Šæ¬„ -->
        <div class="flex flex-col gap-4 w-72 h-[500px]">
            <div class="flex flex-col items-center">
                <div id="sprite-bubble" class="sprite-bubble">æº–å‚™å¥½äº†å—ï¼Ÿ</div>
                <svg id="sprite-svg" class="w-20 h-20" viewBox="0 0 100 100">
                    <circle cx="50" cy="55" r="35" fill="#0ea5e9" />
                    <circle cx="38" cy="45" r="8" fill="white" />
                    <circle cx="62" cy="45" r="8" fill="white" />
                    <circle id="pupil-l" cx="40" cy="45" r="4" fill="#0f172a" />
                    <circle id="pupil-r" cx="60" cy="45" r="4" fill="#0f172a" />
                    <path id="sprite-mouth" d="M 40 65 Q 50 75 60 65" stroke="white" stroke-width="3" fill="none" stroke-linecap="round" />
                </svg>
            </div>
            
            <div class="food-pool" id="food-pool-grid">
                <!-- é£Ÿç‰©å¡ç‰‡ç”± JS å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>
    </main>

    <!-- é®ç½©ä»‹é¢ -->
    <div id="start-mask" class="fixed inset-0 z-[6000] bg-slate-950 flex flex-col items-center justify-center">
        <div class="text-[120px] mb-4">ğŸ±</div>
        <h1 class="text-4xl font-black text-white mb-2">æˆ‘çš„é¤ç›¤ä»»å‹™</h1>
        <p class="text-sky-400 font-bold mb-10 tracking-[0.3em]">å‹•æ…‹éš¨æ©Ÿæ•™å­¸ç‰ˆ</p>
        <button onclick="startGame()" class="bg-white text-slate-950 px-12 py-4 rounded-full font-black text-xl hover:scale-105 transition-all">é–‹å§‹æŒ‘æˆ°</button>
    </div>

    <div id="end-screen" class="fixed inset-0 z-[5000] hidden flex items-center justify-center bg-slate-950/90 backdrop-blur-md">
        <div class="bg-slate-900 p-12 rounded-[40px] text-center border border-white/10 shadow-2xl">
            <div id="end-icon" class="text-8xl mb-4">ğŸ†</div>
            <h2 id="end-title" class="text-3xl font-black mb-2 text-white">ä»»å‹™æˆåŠŸ</h2>
            <p id="end-msg" class="text-slate-400 mb-8">ä½ å°å‡è¡¡é£²é£Ÿçš„æŒæ¡åº¦éå¸¸é«˜ï¼</p>
            <button onclick="resetGame()" class="bg-sky-500 hover:bg-sky-400 text-white px-12 py-4 rounded-2xl font-black text-xl w-full">å†æ¬¡æŒ‘æˆ°</button>
        </div>
    </div>

    <script>
        // é£Ÿæè³‡æ–™åº« (ä¸å«å®¹æ˜“æ··æ·†çš„ç‰ç±³é¸é …)
        const foodDatabase = {
            fruit: [
                { name: 'ç´…è˜‹æœ', icon: 'ğŸ' }, { name: 'é»ƒé¦™è•‰', icon: 'ğŸŒ' },
                { name: 'ç”œè‘¡è„', icon: 'ğŸ‡' }, { name: 'é®®æ©˜å­', icon: 'ğŸŠ' },
                { name: 'ç´…è‰è“', icon: 'ğŸ“' }, { name: 'å¥‡ç•°æœ', icon: 'ğŸ¥' },
                { name: 'ç´…è¥¿ç“œ', icon: 'ğŸ‰' }, { name: 'é’èŠ­æ¨‚', icon: 'ğŸ' }
            ],
            vegetable: [
                { name: 'èŠ±æ¤°èœ', icon: 'ğŸ¥¦' }, { name: 'ç´…è˜¿è””', icon: 'ğŸ¥•' },
                { name: 'ç´«èŒ„å­', icon: 'ğŸ†' }, { name: 'ç¶ è‹¦ç“œ', icon: 'ğŸ¥’' },
                { name: 'å¤§ç•ªèŒ„', icon: 'ğŸ…' }, { name: 'é«˜éº—èœ', icon: 'ğŸ¥¬' },
                { name: 'é®®é¦™è‡', icon: 'ğŸ„' }, { name: 'é’æ±Ÿèœ', icon: 'ğŸ¥¬' }
            ],
            grain: [
                { name: 'ç³™ç±³é£¯', icon: 'ğŸš' }, { name: 'ç´…åœ°ç“œ', icon: 'ğŸ ' },
                { name: 'å…¨éº¥åå¸', icon: 'ğŸ' }, { name: 'ç…®ç‡•éº¥', icon: 'ğŸ¥£' },
                { name: 'é¦¬éˆ´è–¯', icon: 'ğŸ¥”' }, { name: 'æ —å­', icon: 'ğŸŒ°' },
                { name: 'å—ç“œ', icon: 'ğŸƒ' }
            ],
            protein: [
                { name: 'é¯›é­šç‰‡', icon: 'ğŸŸ' }, { name: 'è·åŒ…è›‹', icon: 'ğŸ³' },
                { name: 'æ¿è±†è…', icon: 'ğŸ§Š' }, { name: 'å«©é›è…¿', icon: 'ğŸ—' },
                { name: 'å¤§é®®è¦', icon: 'ğŸ¦' }, { name: 'æ»·ç‰›è‚‰', icon: 'ğŸ¥©' }
            ],
            milk: [
                { name: 'é®®ä¹³', icon: 'ğŸ¥›' }, { name: 'å„ªæ ¼', icon: 'ğŸ¦' },
                { name: 'èµ·å¸', icon: 'ğŸ§€' }
            ],
            oil: [
                { name: 'èŠ±ç”Ÿ', icon: 'ğŸ¥œ' }, { name: 'è…°æœ', icon: 'ğŸŒ°' },
                { name: 'æ ¸æ¡ƒ', icon: 'ğŸ¥¨' }, { name: 'æä»æœ', icon: 'ğŸ¥œ' }
            ],
            junk: [
                { name: 'ç”œç”œåœˆ', icon: 'ğŸ©' }, { name: 'ç‚¸è–¯æ¢', icon: 'ğŸŸ' },
                { name: 'å¯æ¨‚', icon: 'ğŸ¥¤' }, { name: 'å·§å…‹åŠ›', icon: 'ğŸ«' },
                { name: 'æ´‹èŠ‹ç‰‡', icon: 'ğŸ¥”' }, { name: 'æ£’æ£’ç³–', icon: 'ğŸ­' }
            ]
        };

        // å°ç²¾éˆè©±èªè…³æœ¬
        const spriteScripts = {
            intro: [
                "ä»Šå¤©æƒ³åƒé»ä»€éº¼å‘¢ï¼Ÿ",
                "æº–å‚™å¥½æŒ‘æˆ°ç‡Ÿé¤ŠçŸ¥è­˜äº†å—ï¼Ÿ",
                "å˜¿ï¼è®“æˆ‘å€‘ä¾†é…ç½®å®Œç¾çš„é¤ç›¤å§ï¼",
                "å‡è¡¡é£²é£Ÿæ‰èƒ½é•·é«˜å£¯å–”ï¼",
                "ä¾†è©¦è©¦ä½ çš„åˆ†é¡åŠŸåŠ›å§ï¼"
            ],
            correct: [
                "æ­£ç¢ºï¼é€™éå¸¸æœ‰ç‡Ÿé¤Šã€‚",
                "æ²’éŒ¯ï¼Œä½ é¸å°é¡åˆ¥äº†ï¼",
                "å¤ªæ£’äº†ï¼Œé¤ç›¤è®Šå¾—æ›´å‡è¡¡äº†ã€‚",
                "å°ˆå®¶ç­‰ç´šçš„é¸æ“‡ï¼",
                "å°±æ˜¯é€™å€‹ï¼é€™é¡é£Ÿç‰©å¾ˆé‡è¦ã€‚"
            ],
            error: [
                "æ”¾éŒ¯ä½ç½®äº†ï¼Œå†æƒ³æƒ³çœ‹ï¼Ÿ",
                "é€™é¡é£Ÿç‰©ä¸æ‡‰è©²æ”¾åœ¨é€™å€å–”ï¼",
                "å“å‘€ï¼Œé¡åˆ¥æéŒ¯äº†ï¼Œå†è©¦è©¦ã€‚",
                "é€™è£¡ä¼¼ä¹ä¸æ˜¯å®ƒçš„å®¶å‘¢ã€‚"
            ],
            junk: [
                "å“å‘€ï¼é‚£æ˜¯åŠ å·¥é£Ÿå“ï¼Œä¸èƒ½æ”¾é€²é¤ç›¤ã€‚",
                "é‚£æ˜¯é›¶é£Ÿï¼Œå°èº«é«”è² æ“”å¤ªå¤§å–”ï¼",
                "æˆ‘å€‘æ‡‰è©²é¸æ“‡åŸæ…‹é£Ÿç‰©ï¼",
                "é€™å€‹ä¸èƒ½ç®—å…¥å‡è¡¡é£²é£Ÿå…§å‘¢ã€‚"
            ],
            hurry: [
                "æ™‚é–“å¿«åˆ°å›‰ï¼Œå¿«ä¸€é»ï¼",
                "å‰©ä¸åˆ°åç§’äº†ï¼ŒåŠ æ²¹ï¼",
                "å¿«ï¼é¤ç›¤é‚„ç©ºç©ºçš„å‘¢ï¼"
            ],
            alreadyHave: [
                "é€™ä¸€é¡å·²ç¶“æ”å–è¶³å¤ å›‰ï¼",
                "æ›ä¸€å€‹ç¨®é¡çœ‹çœ‹ï¼Œå‡è¡¡æ›´é‡è¦ã€‚",
                "ç›¤å­è£¡å·²ç¶“æœ‰é€™é¡ç‡Ÿé¤Šäº†ã€‚"
            ]
        };

        let timeLeft = 30;
        let collectedCategories = new Set();
        let timerInterval = null;
        let isGameRunning = false;
        let draggedElement = null;

        function getRandomMsg(type) {
            const list = spriteScripts[type];
            return list[Math.floor(Math.random() * list.length)];
        }

        function startGame() {
            document.getElementById('start-mask').style.display = 'none';
            initGame();
        }

        function resetGame() {
            document.getElementById('end-screen').classList.add('hidden');
            initGame();
        }

        function initGame() {
            isGameRunning = true;
            timeLeft = 30;
            collectedCategories = new Set();
            document.getElementById('score-text').innerText = '0 / 6';
            document.getElementById('timer-text').innerText = '30s';
            document.getElementById('placed-items-container').innerHTML = '';
            
            if (timerInterval) clearInterval(timerInterval);
            refreshFoodPool();
            startTimer();
            updateSprite(getRandomMsg('intro'), 'happy');
        }

        function refreshFoodPool() {
            const grid = document.getElementById('food-pool-grid');
            grid.innerHTML = '';
            
            let currentPool = [];
            
            // æ¯é¡éš¨æ©ŸæŠ½å–
            Object.keys(foodDatabase).forEach(cat => {
                if (cat === 'junk') return;
                const items = foodDatabase[cat];
                const picked = items[Math.floor(Math.random() * items.length)];
                currentPool.push({ ...picked, category: cat });
            });

            // éš¨æ©Ÿåƒåœ¾é£Ÿç‰©
            const junks = [...foodDatabase.junk].sort(() => 0.5 - Math.random()).slice(0, 2);
            junks.forEach(j => currentPool.push({ ...j, category: 'junk' }));

            // å¾¹åº•éš¨æ©Ÿæ’åˆ—
            currentPool.sort(() => 0.5 - Math.random()).forEach(item => {
                const card = document.createElement('div');
                card.className = 'food-card';
                card.draggable = true;
                card.innerHTML = `<div class="text-3xl">${item.icon}</div><div class="text-[9px] font-black text-slate-400 uppercase mt-1">${item.name}</div>`;
                card.dataset.category = item.category;
                card.dataset.icon = item.icon;

                card.ondragstart = (e) => {
                    draggedElement = card;
                    card.style.opacity = '0.4';
                };
                card.ondragend = () => {
                    draggedElement = null;
                    card.style.opacity = '1';
                };
                grid.appendChild(card);
            });

            setupDropZones();
        }

        function setupDropZones() {
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.ondragover = (e) => {
                    e.preventDefault();
                    zone.classList.add('active');
                };
                zone.ondragleave = () => zone.classList.remove('active');
                zone.ondrop = (e) => {
                    e.preventDefault();
                    zone.classList.remove('active');
                    handleDrop(zone);
                };
            });
        }

        function handleDrop(zone) {
            if (!draggedElement || !isGameRunning) return;

            const foodCat = draggedElement.dataset.category;
            const zoneCat = zone.dataset.category;

            if (foodCat === 'junk') {
                updateSprite(getRandomMsg('junk'), 'sad');
                return;
            }

            if (foodCat === zoneCat) {
                if (collectedCategories.has(foodCat)) {
                    updateSprite(getRandomMsg('alreadyHave'), 'happy');
                    return;
                }

                collectedCategories.add(foodCat);
                document.getElementById('score-text').innerText = `${collectedCategories.size} / 6`;
                
                const zRect = zone.getBoundingClientRect();
                const pRect = document.getElementById('main-plate').getBoundingClientRect();
                const emoji = document.createElement('div');
                emoji.className = 'placed-item';
                emoji.style.left = (zRect.left - pRect.left + zRect.width / 2) + 'px';
                emoji.style.top = (zRect.top - pRect.top + zRect.height / 2) + 'px';
                emoji.innerText = draggedElement.dataset.icon;
                document.getElementById('placed-items-container').appendChild(emoji);
                
                draggedElement.style.visibility = 'hidden';
                updateSprite(getRandomMsg('correct'), 'happy');

                if (collectedCategories.size === 6) endLevel(true);
            } else {
                updateSprite(getRandomMsg('error'), 'thinking');
            }
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                if (!isGameRunning) return;
                timeLeft--;
                document.getElementById('timer-text').innerText = timeLeft + 's';
                
                if (timeLeft === 10) {
                    updateSprite(getRandomMsg('hurry'), 'thinking');
                }
                
                if (timeLeft <= 0) endLevel(false);
            }, 1000);
        }

        function updateSprite(msg, mood) {
            const bubble = document.getElementById('sprite-bubble');
            bubble.style.animation = 'none'; // é‡ç½®å‹•ç•«
            void bubble.offsetWidth; // è§¸ç™¼é‡ç¹ª
            bubble.style.animation = 'bubbleFloat 2s ease-in-out infinite';
            
            bubble.innerText = msg;
            const mouth = document.getElementById('sprite-mouth');
            if (mood === 'happy') mouth.setAttribute('d', 'M 40 65 Q 50 75 60 65');
            else if (mood === 'thinking') mouth.setAttribute('d', 'M 40 68 Q 50 68 60 68');
            else if (mood === 'sad') mouth.setAttribute('d', 'M 40 72 Q 50 62 60 72');
        }

        function endLevel(isWin) {
            isGameRunning = false;
            clearInterval(timerInterval);
            const screen = document.getElementById('end-screen');
            screen.classList.remove('hidden');
            if (isWin) {
                document.getElementById('end-icon').innerText = 'ğŸ†';
                document.getElementById('end-title').innerText = 'ä»»å‹™é”æˆï¼';
                document.getElementById('end-msg').innerText = 'ä½ é…ç½®äº†ä¸€å€‹å®Œç¾çš„å‡è¡¡é¤ç›¤ï¼';
                updateSprite('å¤ªå²å®³äº†ï¼Œä½ æ˜¯ç‡Ÿé¤Šé”äººï¼', 'happy');
            } else {
                document.getElementById('end-icon').innerText = 'âŒ›';
                document.getElementById('end-title').innerText = 'æ™‚é–“åˆ°ï¼';
                document.getElementById('end-msg').innerText = 'å·®ä¸€é»é»ï¼Œä¸‹æ¬¡è¦æ›´å¿«æ”¶é›†å®Œç•¢å–”ï¼';
                updateSprite('æ²’é—œä¿‚ï¼Œå†ä¾†æŒ‘æˆ°ä¸€æ¬¡å§ï¼', 'sad');
            }
        }
    </script>
</body>
</html>